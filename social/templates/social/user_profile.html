{% extends 'base.html' %}
{% load static %}

{% block title %}{{ profile_user.get_display_name }} - GupShup{% endblock %}

{% block extra_css %}
<style>
    .profile-header {
        background: var(--primary-gradient);
        color: white;
        border-radius: 0 0 30px 30px;
        padding: 40px 0;
        margin: -20px 0 30px 0;
    }
    
    .profile-avatar {
        width: 150px;
        height: 150px;
        border-radius: 50%;
        object-fit: cover;
        border: 5px solid white;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
    }
    
    .profile-stats {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 15px;
        padding: 20px;
        backdrop-filter: blur(10px);
    }
    
    .stat-item {
        text-align: center;
        padding: 10px;
    }
    
    .stat-number {
        font-size: 2rem;
        font-weight: bold;
        display: block;
    }
    
    .stat-label {
        font-size: 0.9rem;
        opacity: 0.9;
    }
    
    .action-buttons .btn {
        margin: 5px;
        border-radius: 25px;
        padding: 10px 25px;
        font-weight: 500;
    }
    
    .post-card {
        border: none;
        border-radius: 15px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
        transition: transform 0.2s, box-shadow 0.2s;
        overflow: hidden;
    }
    
    .post-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
    }
    
    .post-media img, .post-media video {
        transition: transform 0.2s;
    }
    
    .post-media img:hover {
        transform: scale(1.02);
    }
    
    .post-content {
        line-height: 1.6;
    }
    
    .hashtags .badge {
        font-size: 0.8rem;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .hashtags .badge:hover {
        background: var(--primary-color) !important;
        color: white !important;
    }
    
    .post-stats span {
        cursor: pointer;
        transition: color 0.2s;
    }
    
    .post-stats span:hover {
        color: var(--primary-color) !important;
    }
    
    .btn-group .btn {
        border-radius: 0;
        border-right: none;
        transition: all 0.2s;
    }
    
    .btn-group .btn:first-child {
        border-top-left-radius: 8px;
        border-bottom-left-radius: 8px;
    }
    
    .btn-group .btn:last-child {
        border-top-right-radius: 8px;
        border-bottom-right-radius: 8px;
        border-right: 1px solid #dee2e6;
    }
    
    .btn-group .btn:hover {
        background-color: var(--primary-color);
        color: white;
        border-color: var(--primary-color);
    }
    
    .read-more-link {
        color: var(--primary-color) !important;
        font-weight: 500;
        font-size: 0.9rem;
    }
    
    .read-more-link:hover {
        color: var(--secondary-color) !important;
        text-decoration: underline !important;
    }
    
    .video-overlay {
        cursor: pointer;
        transition: background-color 0.2s;
    }
    
    .video-overlay:hover {
        background-color: rgba(0, 0, 0, 0.1) !important;
    }
    
    .info-card {
        border: none;
        border-radius: 15px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
    }
    
    .privacy-notice {
        background: linear-gradient(135deg, #fff3cd, #ffeaa7);
        border: none;
        border-radius: 15px;
        padding: 20px;
        text-align: center;
    }
    
    .tab-content {
        margin-top: 20px;
    }
    
    .nav-pills .nav-link {
        border-radius: 25px;
        margin: 0 5px;
        font-weight: 500;
    }
    
    .nav-pills .nav-link.active {
        background: var(--primary-gradient);
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <!-- Profile Header -->
    <div class="profile-header">
        <div class="row align-items-center">
            <div class="col-md-3 text-center">
                {% if profile_user.avatar %}
                    <img src="{{ profile_user.avatar.url }}" 
                         alt="{{ profile_user.get_display_name }}" class="profile-avatar">
                {% else %}
                    <div class="profile-avatar bg-white d-flex align-items-center justify-content-center mx-auto">
                        <i class="bi bi-person-fill fs-1 text-primary"></i>
                    </div>
                {% endif %}
            </div>
            
            <div class="col-md-6">
                <h1 class="mb-2">{{ profile_user.get_display_name }}</h1>
                <p class="mb-2 fs-5">@{{ profile_user.username }}</p>
                
                {% if profile_user.bio %}
                    <p class="mb-3">{{ profile_user.bio }}</p>
                {% endif %}
                
                <div class="d-flex flex-wrap align-items-center">
                    {% if profile_user.city %}
                        <span class="me-3"><i class="bi bi-geo-alt"></i> {{ profile_user.city }}</span>
                    {% endif %}
                    
                    <span class="me-3">
                        <i class="bi bi-calendar3"></i> 
                        Joined {{ profile_user.date_joined|date:"F Y" }}
                    </span>
                </div>
            </div>
            
            <div class="col-md-3">
                <!-- Stats -->
                <div class="profile-stats">
                    <div class="row">
                        <div class="col-4 stat-item">
                            <span class="stat-number">{{ profile_user.posts.count }}</span>
                            <span class="stat-label">Posts</span>
                        </div>
                        <div class="col-4 stat-item">
                            <a href="{% url 'social:followers' profile_user.username %}" class="text-white text-decoration-none">
                                <span class="stat-number">{{ profile_user.followers.count }}</span>
                                <span class="stat-label">Followers</span>
                            </a>
                        </div>
                        <div class="col-4 stat-item">
                            <a href="{% url 'social:following' profile_user.username %}" class="text-white text-decoration-none">
                                <span class="stat-number">{{ profile_user.following.count }}</span>
                                <span class="stat-label">Following</span>
                            </a>
                        </div>
                    </div>
                </div>
                
                <!-- Action Buttons -->
                <div class="action-buttons text-center mt-3">
                    {% if profile_user == user %}
                        <a href="{% url 'accounts:profile_edit' %}" class="btn btn-light">
                            <i class="bi bi-pencil"></i> Edit Profile
                        </a>
                    {% else %}
                        {% if profile_user in user.following.all %}
                            <button class="btn btn-light" onclick="toggleFollow('{{ profile_user.username }}', this)">
                                <i class="bi bi-person-check"></i> Following
                            </button>
                        {% else %}
                            <button class="btn btn-light" onclick="toggleFollow('{{ profile_user.username }}', this)">
                                <i class="bi bi-person-plus"></i> Follow
                            </button>
                        {% endif %}
                        
                        <a href="{% url 'messaging:message_from_profile' profile_user.username %}" class="btn btn-light">
                            <i class="bi bi-chat-dots"></i> Message
                        </a>
                        
                        <button class="btn btn-outline-light" onclick="shareProfile()">
                            <i class="bi bi-share"></i> Share
                        </button>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Check if profile is viewable -->
    {% if not can_view_profile %}
        <div class="row justify-content-center">
            <div class="col-lg-6">
                <div class="privacy-notice">
                    <i class="bi bi-lock fs-1 text-warning mb-3"></i>
                    <h4>This Profile is Private</h4>
                    <p class="mb-3">
                        {% if profile_user in user.following.all %}
                            This user has a private profile. Follow them to see their posts and information.
                        {% else %}
                            Only followers can see {{ profile_user.get_display_name }}'s posts and information.
                        {% endif %}
                    </p>
                    {% if not profile_user in user.following.all %}
                        <button class="btn btn-primary" onclick="toggleFollow('{{ profile_user.username }}', this)">
                            <i class="bi bi-person-plus"></i> Send Follow Request
                        </button>
                    {% endif %}
                </div>
            </div>
        </div>
    {% else %}
        <!-- Profile Content Tabs -->
        <div class="row">
            <div class="col-12">
                <ul class="nav nav-pills justify-content-center" id="profileTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="posts-tab" data-bs-toggle="pill" 
                                data-bs-target="#posts" type="button" role="tab">
                            <i class="bi bi-grid-3x3"></i> Posts
                        </button>
                    </li>
                    
                    {% if profile_user == user or not profile_user.is_private %}
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="about-tab" data-bs-toggle="pill" 
                                    data-bs-target="#about" type="button" role="tab">
                                <i class="bi bi-person"></i> About
                            </button>
                        </li>
                    {% endif %}
                    
                    {% if mutual_friends %}
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="mutual-tab" data-bs-toggle="pill" 
                                    data-bs-target="#mutual" type="button" role="tab">
                                <i class="bi bi-people"></i> Mutual Friends
                            </button>
                        </li>
                    {% endif %}
                </ul>
            </div>
        </div>

        <!-- Tab Content -->
        <div class="tab-content" id="profileTabsContent">
            <!-- Posts Tab -->
            <div class="tab-pane fade show active" id="posts" role="tabpanel">
                {% if posts %}
                    <div class="row">
                        {% for post in posts %}
                            <div class="col-lg-6 mb-4">
                                <div class="card post-card">
                                    <!-- Post Header -->
                                    <div class="card-body pb-2">
                                        <div class="d-flex align-items-center justify-content-between mb-3">
                                            <div class="d-flex align-items-center">
                                                {% if post.author.avatar %}
                                                    <img src="{{ post.author.avatar.url }}" 
                                                         alt="{{ post.author.get_display_name }}" 
                                                         class="rounded-circle me-3" width="40" height="40">
                                                {% else %}
                                                    <div class="rounded-circle bg-primary d-flex align-items-center justify-content-center me-3" 
                                                         style="width: 40px; height: 40px;">
                                                        <i class="bi bi-person-fill text-white"></i>
                                                    </div>
                                                {% endif %}
                                                
                                                <div>
                                                    <h6 class="mb-0">{{ post.author.get_display_name }}</h6>
                                                    <small class="text-muted">
                                                        {{ post.created_at|timesince }} ago
                                                        {% if post.is_edited %}<i class="bi bi-pencil-square ms-1" title="Edited"></i>{% endif %}
                                                        {% if post.location %} • <i class="bi bi-geo-alt"></i> {{ post.location }}{% endif %}
                                                    </small>
                                                </div>
                                            </div>
                                            {% if post.privacy != 'public' %}
                                                <span class="badge bg-secondary">
                                                    {% if post.privacy == 'friends' %}<i class="bi bi-people"></i> Friends{% else %}<i class="bi bi-lock"></i> Private{% endif %}
                                                </span>
                                            {% endif %}
                                        </div>
                                        
                                        <!-- Post Content -->
                                        {% if post.content %}
                                            <div class="post-content mb-3">
                                                {% if post.content|length > 200 %}
                                                    <p class="card-text">
                                                        <span class="post-text">{{ post.content|truncatewords:30 }}</span>
                                                        <a href="{% url 'posts:detail' post.id %}" class="text-decoration-none read-more-link">... Read more</a>
                                                    </p>
                                                {% else %}
                                                    <p class="card-text">{{ post.content }}</p>
                                                {% endif %}
                                            </div>
                                        {% endif %}
                                        
                                        <!-- Hashtags -->
                                        {% if post.get_hashtag_list %}
                                            <div class="hashtags mb-3">
                                                {% for hashtag in post.get_hashtag_list %}
                                                    <span class="badge bg-light text-primary me-1">#{{ hashtag }}</span>
                                                {% endfor %}
                                            </div>
                                        {% endif %}
                                    </div>
                                    
                                    <!-- Media Display -->
                                    {% if post.media_files.exists %}
                                        <div class="post-media mb-3 position-relative">
                                            {% with first_media=post.media_files.first %}
                                                {% if first_media.media_type == 'image' %}
                                                    <img src="{{ first_media.file.url }}" 
                                                         alt="Post image" 
                                                         class="img-fluid w-100" 
                                                         style="max-height: 300px; object-fit: cover; cursor: pointer; border-radius: 10px;"
                                                         onclick="openImageModal('{{ first_media.file.url }}', 'Post image')">
                                                {% elif first_media.media_type == 'video' %}
                                                    <video controls class="w-100" style="max-height: 300px; border-radius: 10px;">
                                                        <source src="{{ first_media.file.url }}" type="video/mp4">
                                                        Your browser does not support the video tag.
                                                    </video>
                                                {% endif %}
                                                
                                                {% if post.media_files.count > 1 %}
                                                    <div class="position-absolute top-0 end-0 m-2">
                                                        <span class="badge bg-dark bg-opacity-75 text-white">
                                                            <i class="bi bi-stack"></i> {{ post.media_files.count }}
                                                        </span>
                                                    </div>
                                                {% endif %}
                                            {% endwith %}
                                        </div>
                                    {% endif %}
                                    
                                    <!-- Post Actions -->
                                    <div class="card-body pt-2">
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <div class="post-stats">
                                                <span class="text-muted me-3">
                                                    <i class="bi bi-heart text-danger"></i> {{ post.likes_count }}
                                                </span>
                                                <span class="text-muted me-3">
                                                    <i class="bi bi-chat text-primary"></i> {{ post.comments_count }}
                                                </span>
                                                <span class="text-muted me-3">
                                                    <i class="bi bi-share text-success"></i> {{ post.shares_count }}
                                                </span>
                                                {% if post.views_count > 0 %}
                                                    <span class="text-muted">
                                                        <i class="bi bi-eye text-info"></i> {{ post.views_count }}
                                                    </span>
                                                {% endif %}
                                            </div>
                                        </div>
                                        
                                        <!-- Action Buttons -->
                                        <div class="d-flex justify-content-between align-items-center border-top pt-2">
                                            <div class="btn-group btn-group-sm" role="group">
                                                <button type="button" class="btn btn-outline-secondary" 
                                                        onclick="toggleLike('{{ post.id }}', this)" 
                                                        title="Like">
                                                    <i class="bi bi-heart"></i> Like
                                                </button>
                                                <button type="button" class="btn btn-outline-secondary" 
                                                        onclick="focusComment('{{ post.id }}')" 
                                                        title="Comment">
                                                    <i class="bi bi-chat"></i> Comment
                                                </button>
                                                <button type="button" class="btn btn-outline-secondary" 
                                                        onclick="sharePost('{{ post.id }}')" 
                                                        title="Share">
                                                    <i class="bi bi-share"></i> Share
                                                </button>
                                            </div>
                                            
                                            <a href="{% url 'posts:detail' post.id %}" class="btn btn-sm btn-primary">
                                                <i class="bi bi-eye"></i> View Full Post
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                    
                    <!-- Pagination -->
                    {% if posts.has_other_pages %}
                        <nav aria-label="Posts pagination">
                            <ul class="pagination justify-content-center">
                                {% if posts.has_previous %}
                                    <li class="page-item">
                                        <a class="page-link" href="?page={{ posts.previous_page_number }}">Previous</a>
                                    </li>
                                {% endif %}
                                
                                <li class="page-item active">
                                    <span class="page-link">{{ posts.number }} of {{ posts.paginator.num_pages }}</span>
                                </li>
                                
                                {% if posts.has_next %}
                                    <li class="page-item">
                                        <a class="page-link" href="?page={{ posts.next_page_number }}">Next</a>
                                    </li>
                                {% endif %}
                            </ul>
                        </nav>
                    {% endif %}
                {% else %}
                    <div class="text-center py-5">
                        <i class="bi bi-file-post fs-1 text-muted mb-3"></i>
                        <h4>No Posts Yet</h4>
                        <p class="text-muted">
                            {% if profile_user == user %}
                                Start sharing your thoughts with the GupShup community!
                            {% else %}
                                {{ profile_user.get_display_name }} hasn't shared any posts yet.
                            {% endif %}
                        </p>
                        {% if profile_user == user %}
                            <a href="{% url 'posts:feed' %}" class="btn btn-primary">
                                <i class="bi bi-plus-circle"></i> Create Your First Post
                            </a>
                        {% endif %}
                    </div>
                {% endif %}
            </div>
            
            <!-- About Tab -->
            {% if profile_user == user or not profile_user.is_private %}
                <div class="tab-pane fade" id="about" role="tabpanel">
                    <div class="row">
                        <div class="col-lg-8 mx-auto">
                            <div class="card info-card">
                                <div class="card-body">
                                    <h5 class="card-title">
                                        <i class="bi bi-person-lines-fill"></i> About {{ profile_user.get_display_name }}
                                    </h5>
                                    
                                    {% if profile_user.bio %}
                                        <div class="mb-4">
                                            <h6>Bio</h6>
                                            <p>{{ profile_user.bio }}</p>
                                        </div>
                                    {% endif %}
                                    
                                    <div class="row">
                                        {% if profile_user.city %}
                                            <div class="col-md-6 mb-3">
                                                <h6><i class="bi bi-geo-alt text-primary"></i> Location</h6>
                                                <p>{{ profile_user.city }}{% if profile_user.state %}, {{ profile_user.get_state_display }}{% endif %}</p>
                                            </div>
                                        {% endif %}
                                        
                                        {% if profile_user.date_of_birth %}
                                            <div class="col-md-6 mb-3">
                                                <h6><i class="bi bi-calendar text-primary"></i> Birthday</h6>
                                                <p>{{ profile_user.date_of_birth|date:"F j" }}</p>
                                            </div>
                                        {% endif %}
                                    </div>
                                    
                                    <hr>
                                    <div class="text-muted">
                                        <small>
                                            <i class="bi bi-calendar3"></i> 
                                            Joined GupShup {{ profile_user.date_joined|date:"F Y" }}
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            {% endif %}
            
            <!-- Mutual Friends Tab -->
            {% if mutual_friends %}
                <div class="tab-pane fade" id="mutual" role="tabpanel">
                    <div class="row">
                        <div class="col-12">
                            <h4 class="text-center mb-4">
                                <i class="bi bi-people"></i> 
                                {{ mutual_friends|length }} Mutual Friend{{ mutual_friends|length|pluralize }}
                            </h4>
                        </div>
                    </div>
                    
                    <div class="row">
                        {% for friend in mutual_friends %}
                            <div class="col-lg-3 col-md-4 col-sm-6 mb-4">
                                <div class="card info-card text-center">
                                    <div class="card-body">
                                        {% if friend.avatar %}
                                            <img src="{{ friend.avatar.url }}" 
                                                 alt="{{ friend.get_display_name }}" 
                                                 class="rounded-circle mb-3" width="60" height="60">
                                        {% else %}
                                            <div class="rounded-circle bg-primary d-flex align-items-center justify-content-center mb-3 mx-auto" 
                                                 style="width: 60px; height: 60px;">
                                                <i class="bi bi-person-fill text-white fs-4"></i>
                                            </div>
                                        {% endif %}
                                        
                                        <h6 class="card-title">{{ friend.get_display_name }}</h6>
                                        <p class="text-muted small">@{{ friend.username }}</p>
                                        
                                        <a href="{% url 'social:profile' friend.username %}" 
                                           class="btn btn-sm btn-outline-primary">
                                            View Profile
                                        </a>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            {% endif %}
        </div>
    {% endif %}
</div>

<script>
// Follow/Unfollow functionality
async function toggleFollow(username, button) {
    try {
        const response = await fetch(`/social/follow/${username}/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': getCookie('csrftoken'),
                'Content-Type': 'application/json',
            },
        });

        const data = await response.json();
        
        if (data.success) {
            if (data.action === 'followed') {
                button.innerHTML = '<i class="bi bi-person-check"></i> Following';
                button.className = button.className.replace('btn-light', 'btn-outline-light');
            } else {
                button.innerHTML = '<i class="bi bi-person-plus"></i> Follow';
                button.className = button.className.replace('btn-outline-light', 'btn-light');
            }
        } else {
            alert('Error: ' + data.message);
        }
    } catch (error) {
        console.error('Error:', error);
        alert('An error occurred. Please try again.');
    }
}

// Share profile functionality
function shareProfile() {
    if (navigator.share) {
        navigator.share({
            title: `{{ profile_user.get_display_name }} on GupShup`,
            text: `Check out {{ profile_user.get_display_name }}'s profile on GupShup!`,
            url: window.location.href
        });
    } else {
        // Fallback: Copy to clipboard
        navigator.clipboard.writeText(window.location.href).then(() => {
            alert('Profile link copied to clipboard!');
        });
    }
}

// Image modal for full-size viewing
function openImageModal(imageUrl, caption) {
    // Create modal if it doesn't exist
    let modal = document.getElementById('imageModal');
    if (!modal) {
        modal = document.createElement('div');
        modal.id = 'imageModal';
        modal.className = 'modal fade';
        modal.innerHTML = `
            <div class="modal-dialog modal-lg modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Image</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body text-center">
                        <img id="modalImage" src="" alt="" class="img-fluid">
                        <p id="modalCaption" class="mt-2 text-muted"></p>
                    </div>
                </div>
            </div>
        `;
        document.body.appendChild(modal);
    }
    
    // Update modal content
    document.getElementById('modalImage').src = imageUrl;
    document.getElementById('modalCaption').textContent = caption;
    
    // Show modal
    new bootstrap.Modal(modal).show();
}

// Like toggle functionality
function toggleLike(postId, button) {
    // Add visual feedback immediately
    const icon = button.querySelector('i');
    const wasLiked = icon.classList.contains('bi-heart-fill');
    
    if (wasLiked) {
        icon.classList.remove('bi-heart-fill', 'text-danger');
        icon.classList.add('bi-heart');
        button.classList.remove('btn-danger');
        button.classList.add('btn-outline-secondary');
    } else {
        icon.classList.remove('bi-heart');
        icon.classList.add('bi-heart-fill', 'text-danger');
        button.classList.remove('btn-outline-secondary');
        button.classList.add('btn-outline-danger');
    }
    
    // TODO: Add AJAX call to update like status on server
    // fetch('/social/like/' + postId + '/', { method: 'POST', ... })
}

// Focus comment input (when viewing full post)
function focusComment(postId) {
    // Navigate to full post view where comment functionality exists
    window.location.href = `/posts/${postId}/`;
}

// Share post functionality
function sharePost(postId) {
    const postUrl = window.location.origin + `/posts/${postId}/`;
    
    if (navigator.share) {
        // Use native sharing on mobile
        navigator.share({
            title: 'Check out this post on GupShup',
            text: 'Interesting post on GupShup!',
            url: postUrl
        }).catch(err => console.log('Error sharing:', err));
    } else {
        // Fallback: Copy to clipboard
        navigator.clipboard.writeText(postUrl).then(() => {
            // Show success message
            showToast('Post link copied to clipboard!');
        }).catch(err => {
            console.error('Failed to copy: ', err);
            // Fallback: Show share modal
            showShareModal(postUrl);
        });
    }
}

// Show toast notification
function showToast(message) {
    // Create toast if it doesn't exist
    let toastContainer = document.getElementById('toastContainer');
    if (!toastContainer) {
        toastContainer = document.createElement('div');
        toastContainer.id = 'toastContainer';
        toastContainer.className = 'toast-container position-fixed bottom-0 end-0 p-3';
        document.body.appendChild(toastContainer);
    }
    
    const toast = document.createElement('div');
    toast.className = 'toast show';
    toast.setAttribute('role', 'alert');
    toast.innerHTML = `
        <div class="toast-header">
            <i class="bi bi-check-circle-fill text-success me-2"></i>
            <strong class="me-auto">GupShup</strong>
            <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
        </div>
        <div class="toast-body">${message}</div>
    `;
    
    toastContainer.appendChild(toast);
    
    // Auto remove after 3 seconds
    setTimeout(() => {
        toast.remove();
    }, 3000);
}

// Show share modal (fallback)
function showShareModal(url) {
    let modal = document.getElementById('shareModal');
    if (!modal) {
        modal = document.createElement('div');
        modal.id = 'shareModal';
        modal.className = 'modal fade';
        modal.innerHTML = `
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title"><i class="bi bi-share"></i> Share Post</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="input-group mb-3">
                            <input type="text" class="form-control" id="shareUrl" readonly>
                            <button class="btn btn-outline-secondary" type="button" onclick="copyShareUrl()">Copy</button>
                        </div>
                        <div class="d-grid gap-2">
                            <a href="#" class="btn btn-outline-primary" target="_blank" id="shareWhatsApp">
                                <i class="bi bi-whatsapp"></i> Share on WhatsApp
                            </a>
                            <a href="#" class="btn btn-outline-info" target="_blank" id="shareTwitter">
                                <i class="bi bi-twitter"></i> Share on Twitter
                            </a>
                            <a href="#" class="btn btn-outline-primary" target="_blank" id="shareFacebook">
                                <i class="bi bi-facebook"></i> Share on Facebook
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        `;
        document.body.appendChild(modal);
    }
    
    // Update share URLs
    document.getElementById('shareUrl').value = url;
    document.getElementById('shareWhatsApp').href = `https://wa.me/?text=${encodeURIComponent('Check out this post: ' + url)}`;
    document.getElementById('shareTwitter').href = `https://twitter.com/intent/tweet?url=${encodeURIComponent(url)}&text=${encodeURIComponent('Check out this post on GupShup!')}`;
    document.getElementById('shareFacebook').href = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`;
    
    new bootstrap.Modal(modal).show();
}

function copyShareUrl() {
    const urlInput = document.getElementById('shareUrl');
    urlInput.select();
    document.execCommand('copy');
    showToast('Link copied to clipboard!');
}

// Get CSRF token
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
</script>
{% endblock %}